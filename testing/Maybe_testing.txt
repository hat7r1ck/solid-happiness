let
    SourcePath = "C:\Users\k111609\Downloads\Raw_Data",
    Source = Folder.Files(SourcePath),
    #"Filtered Files" = Table.SelectRows(Source, each ([Extension] = ".xlsx") and not Text.StartsWith([Name], "~$")),

    GetStandardizedTable = (BinaryContent) =>
        let
            wb = Excel.Workbook(BinaryContent),
            // Robust Sheet Selection: Checks for 'Complete Data', then 'Data', then falls back to the last sheet
            sheet = if Table.Contains(wb, [Name="Complete Data"]) then wb{[Name="Complete Data"]}[Data]
                    else if Table.Contains(wb, [Name="Data"]) then wb{[Name="Data"]}[Data]
                    else Table.Last(Table.SelectRows(wb, each [Kind]="Sheet"))[Data],
            headers = Table.PromoteHeaders(sheet),
            colNames = Table.ColumnNames(headers),

            // 1. DATE: Finds 'Occurred', 'Created', or 'Date'
            DateCol = List.First(List.Select(colNames, each 
                Text.Contains(_, "occurred", Comparer.OrdinalIgnoreCase) or 
                Text.Contains(_, "created", Comparer.OrdinalIgnoreCase) or 
                Text.Contains(_, "date", Comparer.OrdinalIgnoreCase))),

            // 2. REMEDIATE: Finds 'Remediate'
            RemCol = List.First(List.Select(colNames, each Text.Contains(_, "remediate", Comparer.OrdinalIgnoreCase))),

            // 3. PICKUP: Explicitly targets 'Pickup Time' first (Best Data), then falls back to others
            AckCol = List.First(List.Select(colNames, each 
                Text.Contains(_, "Pickup Time", Comparer.OrdinalIgnoreCase) or 
                Text.Contains(_, "Time to Pick Up", Comparer.OrdinalIgnoreCase) or
                Text.Contains(_, "Acknowledge", Comparer.OrdinalIgnoreCase))),

            // Rename found columns to standard names
            Renamed = Table.RenameColumns(headers, List.RemoveNulls({
                if DateCol <> null then {DateCol, "Raw_Date"} else null,
                if RemCol <> null then {RemCol, "Raw_MTTR"} else null,
                if AckCol <> null then {AckCol, "Raw_MTTP"} else null
            })),

            // FIX: MissingField.UseNull prevents crash if 'Pickup Time' is missing in an old file
            Selected = Table.SelectColumns(Renamed, {"Raw_Date", "Raw_MTTR", "Raw_MTTP"}, MissingField.UseNull)
        in
            Selected,

    #"Processed" = Table.AddColumn(#"Filtered Files", "Data", each GetStandardizedTable([Content])),
    #"Combined" = Table.Combine(#"Processed"[Data])
in
    #"Combined"

