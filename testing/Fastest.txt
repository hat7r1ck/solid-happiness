| eval detection_time = _time
| eval rule_name        = coalesce(risk_message, rule_title, search_name)
| eval rule_description = coalesce(description, "N/A")
| eval alert_status     = "Alerted"

| append [
    | inputlookup RIR-Deduplicate.csv
    | eval _entity = trim(lower("$tok_entity$"))
    | where len(_entity) > 0 
        AND alert="no" 
        AND lower(risk_object)=_entity
    | eval detection_time   = _time
    | eval rule_name        = search_name
    | eval rule_description = "Suppressed by deduplication"
    | eval alert_status     = "Suppressed"
    | fields detection_time risk_object source alert risk_score rule_name rule_description alert_status
]

| eval detection_time = strftime(detection_time,"%Y-%m-%d %H:%M:%S UTC")

| table detection_time risk_object source alert_status risk_score rule_name rule_description
| rename detection_time as "Detection Time",
         risk_object    as "Risk Object",
         source         as "Risk Rule",
         alert_status   as "Alert Status",
         risk_score     as "Risk Score",
         rule_name      as "Rule",
         rule_description as "Rule Description"
| sort - "Detection Time"
