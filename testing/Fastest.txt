ggg

| from datamodel:"Risk.All_Risk"
| eval source = search_name
| lookup RIR-Deduplicate.csv _time risk_object source risk_score OUTPUT alert
| eval _entity = trim(lower("$tok_entity$"))
| where len(_entity) > 0
| where lower(risk_object) = _entity



| from datamodel:"Risk.All_Risk"
| eval source = search_name
| lookup RIR-Deduplicate.csv _time risk_object source risk_score OUTPUT alert
| eval _entity = trim(lower("$tok_entity$"))
| where len(_entity) > 0
| where lower(risk_object) = _entity
| eval alert_status = case(alert="no","Suppressed", isnull(alert),"Unknown", 1=1,"Alert")
| eval rule_name = coalesce(risk_message, search_name)
| eval summary   = coalesce(description, risk_message, search_name)
| table _time alert_status risk_object risk_object_type risk_score rule_name summary source
| sort -_time




`wf_ctfc_notable_base`
... normalization to _m_user, _m_host, etc ...
| where hit=1




| stats
    dc(_time) as event_count
    values(_m_host) as hosts
    dc(_m_host) as device_count
  by _m_user
| sort -event_count


| table _time _m_user _m_host risk_object risk_score rule_title status_label urgency alert
| sort -_time





| inputlookup RIR-Deduplicate.csv
| eval _entity = trim(lower("$tok_entity$"))
| where len(_entity) > 0
| fillnull value="yes" alert
| where alert="no" AND lower(risk_object)=_entity
| stats count as suppressed_count


| inputlookup RIR-Deduplicate.csv
| eval _entity = trim(lower("$tok_entity$"))
| where len(_entity) > 0
| fillnull value="yes" alert
| where alert="no" AND lower(risk_object)=_entity
| stats count as count by previousStatus source
| sort -count



| eval series="Detections"
| fields _time series
| append [
    | inputlookup RIR-Deduplicate.csv
    | eval _entity = trim(lower("$tok_entity$"))
    | where len(_entity) > 0
    | fillnull value="yes" alert
    | where alert="no" AND lower(risk_object)=_entity
    | eval series="Suppressed"
    | fields _time series
]
| timechart span=1d count by series useother=false






